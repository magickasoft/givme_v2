"use strict";function SettingsContact(e,t){return{getFromJSON:function(a){var r=t.defer(),i="",n=[],o="http://52.19.92.65/api/profile/contact/";return e.get(o).then(function(e){var t=e.data;r.resolve({contact:t})})["catch"](function(e){r.reject(e)}),r.promise},update:function(a){var r=t.defer();return e.post("http://52.19.92.65/api/profile/contact/",{data:a}).then(function(e){var t=result.data;r.resolve({contact:t})})["catch"](function(e){r.reject(e)}),r.promise}}}function SettingsDiscovery(e,t){return{getFromJSON:function(a){var r=t.defer(),i="",n=[],o="http://52.19.92.65/api/profile/discovery/";return e.get(o).then(function(e){var t=e.data;r.resolve({discovery:t})})["catch"](function(e){r.reject(e)}),r.promise},update:function(a){var r=t.defer();return e.post("http://52.19.92.65/api/profile/discovery/",{data:a}).then(function(e){var t=e.data;r.resolve({discovery:t})})["catch"](function(e){r.reject(e)}),r.promise}}}function SettingsTags(e,t){return{getFromJSON:function(a){var r=t.defer(),i="",n=[],o="http://52.19.92.65/api/profile/tags/";return e.get(o).then(function(e){var t=[];if(e.data&&e.data.length)for(var a in e.data)t.push({text:e.data[a].tag,id:e.data[a].id});r.resolve({tags:t})})["catch"](function(e){r.reject(e)}),r.promise},update:function(a){var r=t.defer();return e.post("http://52.19.92.65/api/profile/tags/",{data:a}).then(function(e){var t=[];if(e.data&&e.data.length)for(var a in e.data)t.push({text:e.data[a].tag,id:e.data[a].id});r.resolve({tags:t})})["catch"](function(e){r.reject(e)}),r.promise},"delete":function(a){var r=t.defer();return e["delete"]("http://52.19.92.65/api/profile/tags/"+a).then(function(e){var t=[];if(e.data&&e.data.length)for(var a in e.data)t.push({text:e.data[a].tag,id:e.data[a].id});r.resolve({tags:t})})["catch"](function(e){r.reject(e)}),r.promise}}}function SettingsLanguages(e,t){return{getFromJSON:function(a){var r=t.defer(),i="",n=[],o="http://52.19.92.65/api/profile/languages/";return e.get(o).then(function(e){var t=[];if(e.data&&e.data.length)for(var a in e.data)t.push({text:e.data[a].language,id:e.data[a].id});r.resolve({languages:t})})["catch"](function(e){r.reject(e)}),r.promise},update:function(a){var r=t.defer();return e.post("http://52.19.92.65/api/profile/languages/",{data:a}).then(function(e){var t=[];if(e.data&&e.data.length)for(var a in e.data)t.push({text:e.data[a].language,id:e.data[a].id});r.resolve({languages:t})})["catch"](function(e){r.reject(e)}),r.promise},"delete":function(a){var r=t.defer();return e["delete"]("http://52.19.92.65/api/profile/languages/"+a).then(function(e){var t=[];if(e.data&&e.data.length)for(var a in e.data)t.push({text:e.data[a].language,id:e.data[a].id});r.resolve({languages:t})})["catch"](function(e){r.reject(e)}),r.promise}}}function SettingsPictures(e,t){return{getFromJSON:function(a){var r=t.defer(),i="",n=[],o="http://52.19.92.65/api/profile/pictures/";return e.get(o).then(function(e){var t=[];if(e.data&&e.data.length)for(var a in e.data)t.push({src:"http://52.19.92.65"+e.data[a].picture_100,id:e.data[a].id});r.resolve({pictures:t})})["catch"](function(e){r.reject(e)}),r.promise},update:function(a){var r=t.defer();return e.post("http://52.19.92.65/api/profile/pictures/",a,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(e){var t=[];if(e.data&&e.data.length)for(var a in e.data)t.push({src:"http://52.19.92.65"+e.data[a].picture_100,id:e.data[a].id});r.resolve({pictures:t})})["catch"](function(e){r.reject(e)}),r.promise},"delete":function(a){var r=t.defer();return e["delete"]("http://52.19.92.65/api/profile/pictures/"+a).then(function(e){var t=[];if(e.data&&e.data.length)for(var a in e.data)t.push({src:"http://52.19.92.65"+e.data[a].picture_100,id:e.data[a].id});r.resolve({pictures:t})})["catch"](function(e){r.reject(e)}),r.promise}}}function Profile(e,t,a,r,i,n){return{profile:null,load:function(){var o=this,s={gender:"m",age:30,first_name:"Ollie",last_name:"Bolland",tags:["Ice Cream"],languages:["English","French"],preferences:{gender:"f",min_age:25,max_age:40,radius:40},contacts:{}};if(this.profile){var c=t.defer();return c.resolve(this.profile),c.promise}return t.all([e.get("http://"+n+"/api/users/me/",{headers:{Authorization:"Token "+i.apiKey}})]).then(function(e){var t=e[0].data.user;return t.preferences=e[0].data.user.preferences,t.contacts=e[0].data.contacts,t.pictures=e[0].data.user.photos,t.pockets=e[0].data.pockets,o.userId=t.id,o.profile={userId:t.id,email:t.email,first_name:t.first_name,last_name:t.last_name,gender:t.gender,age:t.age,height:t.height,tags:t.tags,languages:t.languages,radius:t.preferences,photos:o.getAbsolutePhotosFromData(t.pictures),preferences:t.preferences,contacts:t.contacts,pockets:t.pockets},a.localStorage.givme_profile=JSON.stringify(o.profile),o.profile})["catch"](function(e){r.go("login")})},getOrRedirect:function(){var e=t.defer();if(!i.apiKey)return e.reject("error"),r.go("login"),e.promise;if(!this.profile){if(!a.localStorage.givme_profile)return r.go("login"),e.reject("error"),e.promise;this.profile=JSON.parse(a.localStorage.givme_profile)}return e.resolve(this.profile),e.promise},save:function(r){var o=this;return a.localStorage.givme_profile=JSON.stringify(o.profile),t.all([e({method:"PATCH",url:"http://"+n+"/api/users/"+o.userId+"/",headers:{Authorization:"Token "+i.apiKey,"Content-Type":"application/x-www-form-urlencoded"},data:$.param({gender:r.gender,first_name:r.first_name,last_name:r.last_name,languages:JSON.stringify(r.languages),tags:JSON.stringify(r.tags),age:r.age})}),e({method:"PUT",url:"http://"+n+"/api/users/preferences/",headers:{Authorization:"Token "+i.apiKey},data:{gender:r.preferences.gender,min_age:r.preferences.min_age,max_age:r.preferences.max_age}})]).then(function(e){return e})["catch"](function(e){return e})},saveLocally:function(e){this.profile=e,a.localStorage.givme_profile=JSON.stringify(this.profile)},saveProfile:function(t){return this.saveLocally(t),e({method:"POST",url:"http://"+n+"/api-rest/profile/",data:{languages:JSON.stringify(t.languages),tags:JSON.stringify(t.tags),height:t.height},headers:{Authorization:"Token "+i.apiKey}}).then(function(e){return e.data})["catch"](function(e){return e})},saveDiscovery:function(t){var r=this;return e({method:"POST",url:"http://"+n+"/api-rest/profile/discovery/",data:t,headers:{Authorization:"Token "+i.apiKey}}).then(function(e){return r.profile.preferences=t,a.localStorage.givme_profile=JSON.stringify(r.profile),e.data})["catch"](function(e){return e})},getAbsolutePhotosFromData:function(e){var t=[];return $.each(e,function(e,a){a.image.indexOf("http")<0&&(a.image="http://52.18.229.105"+a.image),a.thumbnail.indexOf("http")<0&&(a.thumbnail="http://52.18.229.105"+a.thumbnail),t.push(a)}),t},savePhoto:function(r){var o=t.defer(),s=this;return e.post("http://"+n+"/api-rest/profile/pictures/",r,{headers:{"Content-Type":void 0,Authorization:"Token "+i.apiKey},transformRequest:angular.identity}).then(function(e){var t=s.getAbsolutePhotosFromData(e.data);return s.profile.photos=t,a.localStorage.givme_profile=JSON.stringify(s.profile),o.resolve({photos:s.profile.photos})})["catch"](function(e){o.reject(e)}),o.promise},deletePhoto:function(r){var o=t.defer(),s=this;return e["delete"]("http://"+n+"/api-rest/profile/pictures/"+r,{headers:{Authorization:"Token "+i.apiKey}}).then(function(e){var t=s.getAbsolutePhotosFromData(e.data);return s.profile.photos=t,a.localStorage.givme_profile=JSON.stringify(s.profile),o.resolve({photos:s.profile.photos})})["catch"](function(e){o.reject(e)}),o.promise},saveContact:function(t){var r=this;return e({method:"POST",url:"http://"+n+"/api-rest/profile/contact/",data:t,headers:{Authorization:"Token "+i.apiKey}}).then(function(e){return r.profile.contacts=e.data,a.localStorage.givme_profile=JSON.stringify(r.profile),e.data})["catch"](function(e){deferred.reject(e)})},empty:function(){this.profile=void 0,a.localStorage.removeItem("givme_profile"),a.localStorageremoveItem("givme_apikey")}}}angular.module("givmeApp.services").factory("Profile",Profile),angular.module("givmeApp.services").factory("SettingsContact",["$http","$q",SettingsContact]),angular.module("givmeApp.services").factory("SettingsDiscovery",["$http","$q",SettingsDiscovery]),angular.module("givmeApp.services").factory("SettingsTags",["$http","$q",SettingsTags]),angular.module("givmeApp.services").factory("SettingsLanguages",["$http","$q",SettingsLanguages]),angular.module("givmeApp.services").factory("SettingsPictures",["$http","$q",SettingsPictures]);