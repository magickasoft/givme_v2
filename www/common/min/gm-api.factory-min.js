"use strict";function GmAPI(e,t,o,a,r,i,n,s,c){this.apiKey="",this.currentPokeId=0,this.clearApiKey=function(){a.localStorage.removeItem("givme_apikey")},this.confirmAndSetValidApi=function(){if(a.localStorage.givme_apikey){var e=JSON.parse(a.localStorage.givme_apikey);if(e){var t=new Date;return t.getTime()>e.date?void this.clearApiKey():void(this.apiKey=e.key)}}},this.confirmAndSetValidApi(),this._login=function(e){return t.post("http://"+i+"/rest-auth/facebook/",{access_token:e}).then(function(e){return e})["catch"](function(e){return e})},this.loginBrowserForTest=function(){this.apiKey="eb01e5458442f8388745eaa5062c5d4a194c5e68";var e=new Date;a.localStorage.givme_apikey=JSON.stringify({key:this.apiKey,date:e.getTime()+36e5})},this.loginViaFacebook=function(){this.loginBrowserForTest();var t=e.defer();return setTimeout(function(){t.resolve(!0)},500),t.promise;var o=this;return r.login().then(function(e){return o._login(e.access_token).then(function(e){if(e.data){o.apiKey=e.data.key||"";var t=new Date;return a.localStorage.givme_apikey=JSON.stringify({key:o.apiKey,date:t.getTime()+2592e6}),!0}return!1})["catch"](function(e){return e})})["catch"](function(e){return e})},this.requestGame=function(){var o=this,a=e.defer();return t.get("http://"+i+"/api/games/request/?format=json",{headers:{Authorization:"Token "+o.apiKey}}).then(function(e){a.resolve({game:e.data})})["catch"](function(e){a.resolve({game:{players:[{first_name:"Martha",last_name:"Williams",age:28,languages:[],tags:[]},{first_name:"Martha",last_name:"Williams",age:28,languages:[],tags:[]}]},socket:{}})}),a.promise},this.rejectPlayer=function(e){e=1;var o=this;return t({method:"POST",url:"http://"+i+"/api/users/"+e+"/reject/",headers:{Authorization:"Token "+o.apiKey}}).then(function(e){return e})["catch"](function(e){return e})},this.acceptPlayer=function(e){e=1;var o=this;return t({method:"POST",url:"http://"+i+"/api/users/"+e+"/accept/",headers:{Authorization:"Token "+o.apiKey}}).then(function(e){return e})["catch"](function(e){return e})},this.requestRoom=function(){var o=this,a=e.defer();return t.get("http://"+i+"/api/rooms/request/?format=json",{headers:{Authorization:"Token "+o.apiKey}}).then(function(e){var t=new WebSocket("ws://"+i+"/ws/room?token="+o.apiKey+"&subscribe-user&echo");a.resolve({room:e.data,socket:t})})["catch"](function(e){a.resolve({game:{players:[{first_name:"Martha",last_name:"Williams",age:28,languages:[],tags:[]},{first_name:"Martha",last_name:"Williams",age:28,languages:[],tags:[]}]},socket:{}})}),a.promise},this.requestPokedRoom=function(o){var a=this,r=e.defer();return t.get("http://"+i+"/api/rooms/"+o+"/pokerequest/?format=json",{headers:{Authorization:"Token "+a.apiKey}}).then(function(e){a.currentPokeId=e.id,r.resolve(!0)})["catch"](function(e){r.reject()}),r.promise},this.acceptPokeRequest=function(o){var a=this,r=e.defer();return t.get("http://"+i+"/api/rooms/"+o+"/pokerequest/?format=json",{headers:{Authorization:"Token "+a.apiKey}}).then(function(e){console.log(e),r.resolve({room:e.data})})["catch"](function(e){r.resolve({game:{players:[{first_name:"Martha",last_name:"Williams",age:28,languages:[],tags:[]},{first_name:"Martha",last_name:"Williams",age:28,languages:[],tags:[]}]},socket:{}})}),r.promise},this.rejectPokeRequest=function(o){o||(o=this.currentPokeId);var a=this,r=e.defer();return t.get("http://"+i+"/api/rooms/"+o+"/pokereject/?format=json",{headers:{Authorization:"Token "+a.apiKey}}).then(function(e){console.log(e),r.resolve(!0)})["catch"](function(e){r.reject(!1)}),r.promise},this.roomMakeWaiting=function(){var e=this;t.get("http://"+i+"/api/rooms/wait/?format=json",{headers:{Authorization:"Token "+e.apiKey}})},this.roomMakeLive=function(){t.get("http://"+i+"/api/rooms/unwait/?format=json",{headers:{Authorization:"Token "+_this.apiKey}})},this.roomMakeClosed=function(){t.get("http://"+i+"/api/rooms/end/?format=json",{headers:{Authorization:"Token "+_this.apiKey}})},this.roomPokeLater=function(){var o=this,a=e.defer();return t.get("http://"+i+"/api/rooms/pokelater/?format=json",{headers:{Authorization:"Token "+o.apiKey}}).then(function(e){a.resolve(!0)})["catch"](function(e){a.resolve(!1)}),a.promise},this.submitReport=function(o){var a=this,r=e.defer();return t.get("http://"+i+"/api/rooms/report/?format=json",o,{headers:{Authorization:"Token "+a.apiKey}}).then(function(e){r.resolve(!0)})["catch"](function(e){r.resolve(!1)}),r.promise},this.requestContactSocket=function(){var e=this,t=new WebSocket("ws://"+i+"/ws/contacts?token="+e.apiKey+"&subscribe-user&echo");return t},this.sendContactDetails=function(o){var a=this,r=e.defer();return t.post("http://"+i+"/api/rooms/contact/?format=json",o,{headers:{Authorization:"Token "+a.apiKey}}).then(function(e){r.resolve(!0)})["catch"](function(e){r.resolve(!1)}),r.promise}}angular.module("givmeApp.services").service("GmAPI",GmAPI),angular.module("givmeApp").constant("gmAPIServerIP","52.18.229.105");